# 先行研究

## 制約やコスト関数に基づく手法

ピアノ運指の自動推定の研究の最初期のものとして（Parncutt 97）が挙げられる。
まず音符列に対して、人間の指の開く距離を元に、演奏可能でありうる運指パターンを生成する。その各パターンに対して、１２から成るルールによってコストを求め、望ましい運指パターンを割り出す手法である。

1. 無理なく広げられる/縮められる距離よりも広い/狭い運指には２点を加える
2. MinRelよりも狭い運指には、親指を含む場合は１点、それ以外には２点を加える
3. MaxRelよりも広い運指には、親指を含む場合は１点、それ以外には２点を加える
4. 指くぐりや跳躍によるポジション移動を伴う場合、手の位置が完全に移動する場合は２点、それ以外には１点を加える。
5. MinComfよりも狭い音域でポジション移動が生じた場合、音域からMinComfを減じた点を加える。
6. ４指か５指を使った場合１点を加算する
7. ３，４，５指を連続で用いた場合（順不同）、１点を加える
8. ３指の次に４指が来た場合、１点を加える
9. 白鍵上の３指と黒鍵上の４指が連続した場合、１点を加える
10. １指で黒鍵を弾いた場合、１点を加える。直前が白鍵であった場合は２点、直後が白鍵である場合は２点を、更に加える。
11. ５指で黒鍵を弾いた場合、直前が白鍵であった場合は２点、直後が白鍵である場合は２点を加える。
12. 指くぐりに１点を加える。白鍵を弾いた状態で親指が黒鍵を弾く指くぐりには３点を加える。

これは、「演奏可能な規則」と「運指のコスト関数」を人がモデリングした手法と考えられる。
同様に、人間が与えた規則やコスト関数によって、可能な運指から望ましい運指を取り出す手法として、
「同じ指で続けて演奏しない」などの規則を与えてあり得る運指を取り出す手法（林田ら 2003）、
和音間の姿勢の移行コスト関数を与える手法（kasimiら 2005）（若松ら 2012）などがある。
また、（Eric Nellåkerら 2010）はParncuttらの手法に休符を考慮した１３番目のルールを追加した手法を提案している。

一方で、人間がモデリングしたコスト関数がどの程度妥当であるかを評価するのは困難であるという課題がある。
また、先行研究は基本的に手指の動きのみを反映しており、演奏表現は考慮していない。
（Parncuttら 97）も提案手法について、人間工学的には運指の難しさを評価できているが認知的な負荷は反映できていない、としている。

## 統計的手法

一方で、楽譜に対して人間が採番した運指番号のデータをもとに、未知の音符列に対する運指を推定するというアプローチとして、
n-gram 統計を用いた手法（野口ら 1996）や、
隠れマルコフモデルを用いた手法（米林ら 2006）がある。

（米林ら 2006）はHMMを用いる手法のメリットについて以下のように述べている。

> ・運指決定のメカニズムを HMM のモデルパラメー
タの特徴や値により定性的・定量的に述べること
ができる。例えば、隣り合った２つの音符を打鍵
する２本の指の広がりやすさは HMM の出力確
率関数の分布で表され、（２本の）指の独立性の
難易度の違いは HMM の状態遷移確率の大きさ
の違いで表される。
• 推論過程・結果の正当性（尤もらしさ）を確率と
して表現できる。例えば、複雑なルールベースに
おける適用ルールの競合といった問題は生じない。
• 運指を推定するだけでなく、推定された手の状態
（手の形、位置など）をもとに運指の難易度を判定
し、それをベースとした応用研究が可能である。

（米林ら 2006）は、音符列を観測系列、運指を状態とし、各指に対応した５状態と、遷移から音符推移が出力されるHMMとして定式化している。
（5 * 5 = 25の状態から音符推移が出力されると考えても同様）

出力となる音符推移は、音符間の鍵盤位置の差分として表され、
例えばC5 -> E5の推移であれば、(x,y) = (2, 0)、D#5 -> C5の推移であれば、(x,y) = (-1, -1)となる。
つまり、音符間の相対的な距離だけがモデルの入力となり、音長といったその他の属性はモデルには取り込まれない。

同様に、先行研究の多くは音高のみをモデルの対象とし、休符や音長、スタッカートといった要素はモデルに取り込まれていない。
確かに運指決定の大きな要因が音高である一方、一部の重要な性質がモデルに取り込まれず、本来は容易な遷移が不自然に制限されるといった課題を残している。例えば、休符を挟んだり、音長の長い音符の場合は、跳躍が容易であるが、こういった性質が推定に取り込まれないことになる。
（米林ら 2007）はHMMの状態に休符を組み込む手法について課題とし言及している。

> 運指リセットを表す隠れ状態「指 0」を定義し、「指 0」からの/への遷移、および対応する出力確率分布を同じにすることでリセットによる運指自由度を表現することが課題

### 課題

一方でマルコフ性からくる課題として、
例えば１指を用いた指くぐりは自然な動きだが、指くぐりを必要以上に繰り返すことは自然ではない。しかし次の運指は現在の運指にのみ影響されるというマルコフ性を仮定したモデルでは、このような運指が生じてしまう。
長期の依存性が反映されない問題を緩和するため、
隠れ変数の導入（米林ら 2007）、高次マルコフモデルへの拡張（中村ら 2019）といった改善の取り組みがなされている。

また、出現頻度が低いが重要な運指がモデルの出力となるのが難しいという問題もある。
頻度の高い運指とは、演奏者にとっては自明な運指であることが多い。一方で、指の持ち替えや指を寄せる運指など、出現頻度は低いが効果的な運指は、頻度の高い運指を優先した場合は採用されないことになる。

### 出力の多様性

コスト関数を用いる手法にせよHMMにせよ、解候補のうちN-bestを取り出すことで複数の解を得ることが出来る。
一方で、あるモデルから複数の解を得たとしても、それらは同じ観点に基づく似たような出力となるのではないか。（RANDOLPHら 2021）はExpectedReciprocalRank(ERR)を用いて、運指推定モデルの出力する解候補の有効さを評価する枠組みを提案している。

# 参考文献

武内俊之. ピアノ演奏における運指法についての基本概論. 福岡教育大学紀要. 第5分冊, 芸術・保健体育・家政科編 = Bulletin of Fukuoka University of Education. 福岡教育大学 編 (63), 1-8, 2014

三好優美子. 子どもの歌のピアノ演奏時における「ミソラド=1235」ポジションの有効性. 東京女子体育大学東京女子体育短期大学紀要 (44), 67-75, 2009

Richard Parncutt, John Sloboda, Eric Clarke, Matti Raekallio. An Ergonomic Model of Keyboard Fingering for Melodic Fragments. July 1997 Music Perception 14(4):341-381

Alia Al Kasimi, Eric Nichols, Christopher Raphael, Automatic Fingering System(AFS), poster presentation at ISMIR, 2005

野口賢治. nグラムの手法を用いたピアノ運指の推論. 情報処理学会第52回全国大会講演論文集, 1996 2, 101-102, 1996

米林 裕一郎 , 亀岡 弘和 , 嵯峨山 茂樹. 隠れマルコフモデルに基づくピアノ運指の自動決定. 情報処理学会研究報告. MUS,[音楽情報科学] 65, 7-12, 2006-05-13

米林 裕一郎 , 亀岡 弘和 , 嵯峨山 茂樹. 手の自然な動きを考慮した隠れ変数付き隠れマルコフモデルに基づくピアノ運指決定. 情報処理学会研究報告. MUS,[音楽情報科学] 71, 179-184, 2007-08-01

中村 栄太,齋藤 康之,吉井 和佳. ピアノ運指データを用いた統計学習手法による運指推定と演奏難易度の定式化. 研究報告音楽情報科学（MUS）.  2019, vol.2019-MUS-124, no.12, p.1-16.

中村 栄太,齋藤 康之,吉井 和佳. ピアノ運指データを用いた個人性の解析. 研究報告音楽情報科学（MUS）. 2019, vol.2019-MUS-123, no.42, p.1-6.

長田若奈,酒向慎司,北村正. 隠れマルコフモデルによる習熟度に対応したバイオリン運指推定. 情報処理学会研究報告. [音楽情報科学] 2014-MUS-102(11), 1-6, 2014-02-16

David A. RANDOLPH, Barbara DI EUGENIO1, Justin BADGEROW2. EXPECTED RECIPROCAL RANK FOR EVALUATING MUSICAL FINGERING ADVICE. Proceedings of the 18th Sound and Music Computing Conference, June 29th – July 1st 2021.