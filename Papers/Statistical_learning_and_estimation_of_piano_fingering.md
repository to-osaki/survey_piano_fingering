# ピアノ運指データを用いた統計学習手法による運指推定と演奏難易度の定式化

https://www.ipsj.or.jp/kenkyukai/event/mus124.html
2019/8

## 対象

> 本稿では，これまで調べられてきた HMM の高次への拡張
と，多声（ポリフォニック）音楽における制約を取り込む
改良を提案する．また，これまでのモデルのように音符単
位ではなく，和音単位で潜在状態が定義される別の構造を
持つ HMM（和音 HMM と呼ぶ）も提案する．

> 以上の定式化では，モデルは打鍵時刻や離鍵時刻を記述
しておらず，音符の時間順序には依存するが時間間隔には
依存しないモデルになっている．音符の時間間隔はほとん
どの既存研究で考慮されておらず，本研究でも考慮しない．

## 先行研究

> Parncutt ら [10] は，ピアノ運指推定の計算論的手法の
最も初期のものの一つである，

> 最近，Balliauw ら [25] は，Parncutt らの制約に基づく
手法 [10] を多声音楽の取り扱いができるようにさらに拡張
した．彼らは VNS（variable neighborhood search; 可変近
傍探索法）を応用し，定式化した制約に基づく最適な運指
を効率的に見つける方法を提案した．

> 多声部の曲に適用できるコストに基づく方法
が Al Kasimi ら [19] により提案されている．このモデル
は，特定の和音を弾く際の手の広がりを表す垂直コストと，
和音の連なりを弾く際の手の伸びを表す水平コストからな
り，Hart らのモデル [12] の一般化と見なせる．

> 統計モデルに基づく初めてのピアノ運指推定の方法は
Yonebayashi ら [17] により提案された．

> Nakamura ら [24] は
HMM に基づく手法を拡張し，両手の運指に適用できる方
法を開発した．

> 先行研究で提案された手法のうち，VNS
法 [25] のみがソースコードを公開している．この方法
は [10] の手法の改良であり，制約に基づく代表的な手法と
見なせる．

## 手法

> 最も一般の設定では，出力確率 P(pn| pn−1, fn−1, fn) は
88^2· 5^2(∼ 2 × 105) 個のパラメータを持つ．限られたデー
タ量でこれらすべてのパラメータを正確に推定するのは困難

+ 移調対称性
    - C5->D5 と D5->E5 は同じコストとする
+ 時間反転対称性
    - C5->D5 と D5->C5 は同じコストとする
+ 鏡映対称性
    - 右手C5->D5 と 左手C5->B4 は同じコストとする
+ 大きな音高の遷移（跳躍）を等しく扱う
    - C5->B5 と C5->C6 は同じコストとする

> ここでは，文献 [19] で提案されたモデルの確率的定式化である，「和音 HMM」と呼ぶもう一つの HMM を構築する．・・・音符ごとに状態遷移を考える代わりに，このモデルでは状態を和音ごとに定義する．  
・・・  
このモデルの状態は各和音に対する全ての運指の組み合わせにより構成する．和音内では指くぐりはないこと，および各々の音高が別の指で弾かれることを仮定すると  
・・・  
特徴は，離鍵時刻も考慮して，音符が弾
かれている間は後続の和音の構成音に含まれるようになっ
ていることである．替え指の可能性を無視すると，音符が
弾き続けられる時は同じ指が使われるように状態遷移が制約される．

## 評価

> 適切なピアノ運指は唯一ではないことを考慮すれば，複
数の正解データに対して使える評価尺度が必要である [26]．
一つの完全な評価尺度を見つけることは難しいため，いく
つかの可能な尺度をここで提案する．

・一般的一致率　各正解データに対する一致率の平均
・最高一致率　各正解データに対する一致率のうち、最大のもの
・柔軟一致率　各正解データの運指のうち１つでも一致していれば正解
・組換一致率　各正解データを切り貼りした運指列から一致率を求める

> 整数音高表現よりも格子音高表現の方が良いことが分かるが，一致率の改善は比較的小さい

> 統計モデルに基づく手法は，データから効率的にパラメータ
が推定できる長所を持ち，十分な量の学習データがあれば，
1 次の HMM ですら代表的な制約に基づく手法 [25] より
も推定精度が高いことがわかった．  
・・・  
本研究で達成した最高の推定
精度は人間の演奏者間の運指の一致度よりもまだ低く，さ
らなるモデルの改良の方向性について議論した．

> 遷移が休符で遮られた “dead interval” と見なされ，後
続の遷移に対しては G3 を指 5 で弾く方がより適切である
という理由による．同様のフレーズ境界による影響は，図
5(d) の左手の運指での推定誤りにも見られる

> これらの音符は和音により分断されている
ため，適切な運指を見つけるには長距離の依存性を考慮に
入れる必要がある．人間の演奏者による運指ではこのよう
な非常に長距離の依存性が時に観察される

> 通常 1-3 や 2-4 な
どで弾かれる長三度音程や短三度音程に 1-2 や 2-3 の運指
が割り当てられている．通常 1-5 で弾かれる五度の音程に
も他の指が割り当てられることが時々あった

> 2 次の HMM のものの方が正解により近
い．実際，楽譜の中程の G5-E5-A5 に対する運指としては
4-2-5 の方がより自然で，2 次の HMM では考慮される G5
から A5 に移る指の動きがこの判断に重要である．

## 議論

> フレー
ズ，声部，頂点音，あるいは反復構造を捉えるための高レ
ベルの文脈も最適な運指を見つけるために重要な役割を果
たしている．和音 HMM と DNN はこれらの問題の解決に
重要となる可能性がある．前

> 指の長さや演奏の習得レベルなどの個人的差
異は，運指の決定に重要な要因で...
少ないデータで運指の個人的スタイルに適用できるようにするためには，これらの要因を変数で表し，一般的な性質を
定数として表すモデルが理想的であろう．

> 運指のメカニズムを理解するには，
最終的には運指のコストの定量化が必要だと考えられる．

> 運指の決定過程において統計学習
それ自体が重要である可能性も気に留めるべきである．例
えば，現代の運指の実践（例えば [6]）と古典的な実践（例
えば [3]）とは大きく異なる．これらの問題についてのさ
らなる研究は今後の課題とする．

人間が運指を決める際も、実はコストではなく統計的に決定しているのではないか

## 参考

[19] A. Al Kasimi, E. Nichols, and C. Raphael. A simple algorithm for automatic generation of polyphonic piano
fingerings. In Proc. ISMIR, pages 355–356, 2007.

[24] E. Nakamura, N. Ono, and S. Sagayama. Merged-output
HMM for piano fingering of both hands. In Proc. ISMIR,
pages 531–536, 2014.

[25] M. Balliauw, D. Herremans, D. P. Cuervo, and
K. S¨orensen. A variable neighborhood search algorithm
to generate piano fingerings for polyphonic sheet music.
International Transactions in Operational Research,
24(3):509–535, 2017